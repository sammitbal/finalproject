---
title: "FinalProject"
author: "Sammit Bal, Jason Zheng, Thaddeus Poff"
date: "2025-04-27"
output: html_document
---

```{=html}
<style>
blockquote {
  font-size: 1em;
}
</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Frontmatter

```{r}
remove(list = ls())
library(glmnet)
library(rpart)
library(rattle) # for the fancyRpartPlot()
library(tidyverse)
library(readxl)
library(stringr)

CODMaps <- read.csv("./CODMaps.csv")
CODGames_p2_380 <- read.csv("./CODGames_p2_380.csv")
CODGames_p1_380 <- read.csv("./CODGames_p1_380.csv")
CODGameModes <- read.csv("./CODGameModes.csv")

#combined cod dataset
COD_combined <- bind_rows(CODGames_p1_380, CODGames_p2_380)

```

## Task 1: Data Cleaning and Data Visualization

> *Relevant Information:* (Complete without using Generative AI) Prior to each online match, players in the game lobby are presented with two options for the battlefield of the upcoming game (`Map1` and `Map2`). The players have the option to vote and the resulting vote is recorded in the `MapVote` column. The winning map is listed in the `Choice` column. In the event of a tie vote, the map listed in `Map1` is chosen. (Games for which the player entered the lobby after the vote has taken place have no information in `Map1` and `Map2` but have the winning map presented in `Choice`.)

**Research Question:** Which maps are the most likely to win the map vote when they are an option?

*Notes:* To answer this question... 

1.  Write a paragraph (or more) discussing how you plan to answer this question (Be sure to address the data quality issues mentioned below and discuss how you will do the calculations).
2.  Then, write code and answer the question. (If I must answer questions about your approach/decision making process by reading your code rather than your discussion, you will lose points.)
3.  As part of your solution, you should calculate the proportion/probability that a map wins the vote given that it was a candidate.

*Note:* To do this, you will have to calculate the number times that each map was listed as a candidate (Map1 or Map2) and earned more votes than the other candidate.

-   As part of this, you should consider whether a given map won the vote by getting more votes than the other option or if it was selected since it was `Map1` and the vote was a tie.
-   You should also include a visualization of the results.
-   There might be some data quality issues (such as misspelled map names and extra (trailing) blanks in some entries) to solve for this problem.
-   You can find the proper names/spellings in the CODMaps.csv file.
-   **Warning:** To full receive full credit, you must write code to solve these issues rather than editing the `.csv` files


```{r}
COD_combined <- 
COD_combined[COD_combined$Map1 != "", ]

Map_select <- COD_combined %>%
  select(Map1, Map2, Choice)

Map_select$Map1_clean <- tolower(Map_select$Map1)

Map_select$Map2_clean <- tolower(Map_select$Map2)

Map_select$Choice_clean <- tolower(Map_select$Choice)

#found 6 misspellings 
corrections <- c(
  "aPocalypse" = "Apocalypse",
  "apocolypse" = "Apocalypse",
   "Apocolypse" = "Apocalypse",
  "collaterel strike" = "Collateral Strike",
  "apocalypse" = "Apocalypse",
  "deisel" = "Diesel",
  "drive-in" = "Drive-In", 
  "yamantau" = "Yamantau", 
  "miami stirke" = "Miami Strike",
  "riad" = "Raid",
  "ruah" = "Raid",
  "raid " = "Raid",
  "amrada strike" = "Armada Strike",
  "deprogam" = "Deprogram",
  "miami Sstrike" = "Miami Strike",
  "miami Stirke" = "Miami Strike",
  "rush " = "Rush",
  "zoo " = "Zoo",
  "miami sstrike" = "Miami Strike",
  "collateral striek" = "Collateral Strike",
  "collaterol strike" = "Collateral Strike",
  "jungle " = "Jungle",
  "miami " = "Miami"
)

#comparing choices to misspelled words then correcting them if misspelled.
Map_select$Map1_clean <- ifelse(
  Map_select$Map1_clean %in% names(corrections),
  corrections[Map_select$Map1_clean],
  Map_select$Map1  
)

Map_select$Map2_clean <- ifelse(
  Map_select$Map2_clean %in% names(corrections),
  corrections[Map_select$Map2_clean],
  Map_select$Map2  
)

Map_select$Choice_clean <- ifelse(
  Map_select$Choice_clean %in% names(corrections),
  corrections[Map_select$Choice_clean],
  Map_select$Choice  
)

```


```{r}
# Count appearances
appearances <- Map_select %>%
  select(Map1_clean, Map2_clean) %>%
  pivot_longer(cols = everything(), values_to = "Map") %>%
  count(Map, name = "appearances")

# Count wins
wins <- Map_select %>%
  filter(Choice_clean == Map1_clean | Choice_clean == Map2_clean) %>%
  count(Choice_clean, name = "wins") %>%
  rename(Map = Choice_clean)

#calculate win rate
Map_stats <- appearances %>%
  left_join(wins, by = "Map") %>%
  mutate(win_rate = wins / appearances) %>%
  arrange(desc(win_rate))

```


```{r}
ggplot(Map_stats, aes(x = reorder(Map, win_rate), y = win_rate)) +
  geom_col() +
  geom_text(aes(label = paste0("n=", appearances)), 
            hjust = -0.5, 
            size = 3.75) +
  coord_flip() +
  labs(
    title = "Map Win Rate",
    x = "Map",
    y = "Win Rate (Proportion of Times Map Won When Offered)"
  ) +
  theme_minimal() +
  scale_y_continuous(limits = c(0, 1.1)) 

```



## Task 2: Data Cleaning and Data Visualization

**Question:** Repeat Task 1 using a generative AI of your choice.

1.  To answer this question, mention the tool (including version number if appropriate) you have selected.
2.  Then, discuss the prompt(s) you have used and provide the solution produced by the generative AI.

> *Note:* While it is fine to paste the question into the generative AI as your first prompt, you should also use additional follow-up prompts if it is beneficial to do so. - Be sure to discuss all prompts used in your report.

3.  Then, implement the generative AI solution.
4.  Finally, and most importantly, you should compare your solution from Task 1 to the generative AI solution.

> *Note 2:*
>
> -   Discuss similarities/differences, strengths/weaknesses, etc., and provide an overall assessment of which solution is better.
> -   The discussion should consider the correctness of the answers and should be substantial.
> -   Demonstrate that you have given the comparison considerable thought by making at least 3 substantial points as part of your comparison. - Each point should take the form of a well-written paragraph.



Gen AI comparison to my work(fixing spelling mistakes): 

Using Gemini 2.0 I asked: How would you fix misspellings in data in R?

Output I was given: 

```{r, eval=FALSE}

df <- df %>%
  mutate(
    city_corrected = case_when(
      city == "New Yrok" ~ "New York",
      city == "Los Angelas" ~ "Los Angeles",
      TRUE ~ city 
    )
  )
```


To deal with the misspelled words in the dataset I asked ChatGPT:"i need to remove misspelled rows from the dataset."

This was the code provided. 
```{r}
valid_maps <- c("Deprogram", "Collateral Strike", "Collateral", "Amerika", "Crossroads Strike", "Raid", "Rush", "Satellite", "Miami", "Cartel", "Hijacked", "Miami Strike", "Yamantau", "Drive-In", "WMD", "Standoff", "Garrison", "Nuketown '84", "Express", "Zoo", "Armada Strike", "Diesel", "Slums", "Echelon", "Apocalypse", "Checkmate", "Moscow", "The Pines", "Jungle")  # add all correct map names
# filter(MapCandidate %in% valid_maps) (additional code from same prompt to remove misspelled maps)
```



Using chatGPT I asked: "Prior to each online match, players in the game lobby are presented with two options for the battlefield of the upcoming game (Map1 and Map2). The players have the option to vote and the resulting vote is recorded in the MapVote column. The winning map is listed in the Choice column. In the event of a tie vote, the map listed in Map1 is chosen. (Games for which the player entered the lobby after the vote has taken place have no information in Map1 and Map2 but have the winning map presented in Choice.)Which maps are the most likely to win the map vote when they are an option?As part of your solution, you should calculate the proportion/probability that a map wins the vote given that it was a candidate.

*Note:* To do this, you will have to calculate the number times that each map was listed as a candidate (Map1 or Map2) and earned more votes than the other candidate.

-   As part of this, you should consider whether a given map won the vote by getting more votes than the other option or if it was selected since it was Map1 and the vote was a tie.
-   You should also include a visualization of the results.
-   There might be some data quality issues (such as misspelled map names and extra (trailing) blanks in some entries) to solve for this problem." Which gave me this code and visualization. 





```{r, eval=FALSE}

# Step 1: Clean up map names (remove trailing/leading spaces, convert to lowercase if needed)
data_clean <- COD_combined %>%
  mutate(across(c(Map1, Map2, Choice), ~str_trim(.)))




data_clean <- data_clean %>%
  mutate(
    is_draw = str_detect(MapVote, "^\\s*\\d+\\s*to\\s*\\d+\\s*$") &
              as.numeric(str_extract(MapVote, "^\\s*\\d+")) == as.numeric(str_extract(MapVote, "\\d+\\s*$"))
  )

# Step 2: Create a column for which map actually won by vote (excluding ties)
vote_results <- data_clean %>%
  filter(!is.na(Map1) & !is.na(Map2) & !is.na(MapVote)) %>%
  mutate(
    vote_winner = case_when(
      is_draw ~ Map1,
      TRUE ~ Choice
    )
  )


# Step 3: Reshape into long format to count wins and appearances
long_data <- vote_results %>%
  pivot_longer(cols = c(Map1, Map2), names_to = "MapSlot", values_to = "MapCandidate") %>%
  mutate(win = MapCandidate == vote_winner) %>%
  filter(MapCandidate %in% valid_maps)


# Step 4: Count how many times each map was offered and how many times it won
map_stats <- long_data %>%
  group_by(MapCandidate) %>%
  summarise(
    times_offered = n(),
    times_won = sum(win),
    win_rate = times_won / times_offered
  ) %>%
  arrange(desc(win_rate))

  

draws_per_map <- vote_results %>%
  filter(is_draw) %>%
  pivot_longer(cols = c(Map1, Map2), names_to = "MapSlot", values_to = "MapCandidate") %>%
  group_by(MapCandidate) %>%
  summarise(draws = n(), .groups = "drop")



map_stats <- map_stats %>%
  left_join(draws_per_map, by = "MapCandidate") %>%
  mutate(draws = replace_na(draws, 0))  # Fill NA with 0 for maps with no draws



print(map_stats)

```










```{r, eval=FALSE}
ggplot(map_stats, aes(x = reorder(MapCandidate, win_rate), y = win_rate)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Map Win Rate When Offered",
    x = "Map",
    y = "Win Rate"
  ) +
  theme_minimal()

```


## Task 3: Inference

*Relevant Information:* There are a variety games types (GameType variable) within this dataset.

-   The difference between the game types is that players have different objectives for the game.
-   For instance, in the game type “Hardpoint”, teams earn points by capturing and defending a location. - In “TDM” teams earn points by eliminating enemy opponents. As these game types have different objectives and may last for different amounts of time, the game type might affect the TotalXP earned.

**Research Question:** How does the game type affect TotalXP after accounting for the Score?

*Notes:* Score refers to the player’s score, not the “score” of the match (i.e., not the Result column).

-   This answer requires some data wrangling that may require knowledge that we have not covered. (Again, part of the skillset you are working to develop is learning how to answer questions you have not seen previously.)
-   In particular, there is no distinction between HC – TDM and TDM, no difference between HC – Hardpoint and Hardpoint, and so on for the other game types.

**Process of Answering:**

1.  Write code to clean the values in the GameType column to reflect this information.
2.  Then, perform an exploratory data analysis by create appropriate visualizations/summary statistics that explore the distribution of the variables and show the relationship between TotalXP, Score, and GameType. (You decide on the type/number of visualizations, but the analysis should be complete.)
3.  Finally, build an appropriate model for TotalXP based on Score and GameType. You should use the model to then answer the research question.


```{r}
COD_combined <- bind_rows(CODGames_p1_380, CODGames_p2_380)

#Step 1 
df_cleaned <- COD_combined %>%
  mutate(GameType = str_replace(GameType, "^HC.*?(?=\\w)", ""))
```


```{r}
# Summary statistics of Score and TotalXP by GameType
df <- df_cleaned %>%
  group_by(GameType) %>%
  summarize(
    count = n(),
    mean_score = mean(Score, na.rm = TRUE),
    mean_totalxp = mean(TotalXP, na.rm = TRUE),
    sd_totalxp = sd(TotalXP, na.rm = TRUE),
    correlation = cor(Score, TotalXP, use = "complete.obs")
  )


df
```


```{r}

ggplot(df_cleaned, aes(x = Score, y = TotalXP, color = GameType)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE) +
  theme_minimal() +
  labs(title = "Score vs. TotalXP by GameType", x = "Score", y = "TotalXP")


ggplot(df_cleaned, aes(x = GameType, y = TotalXP)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Distribution of TotalXP by GameType", x = "GameType", y = "TotalXP")


ggplot(df, aes(x = GameType, y = mean_score)) +
  geom_boxplot(width = 5)+
  geom_col() +
  labs(title = "Distribution of Score by GameType", x = "GameType", y = "TotalXP") +
  theme_minimal()
  
```



**Analysis:** 



Looking at first scatterplot we can observe a pretty obvious positive correlation between Score and TotalXP. This correlation is shared by all the GameTypes. Looking closer at the best fit lines we can see which GameType has the better correlation. To get a more exact correlation value take a look at the summary statistics which will tell you that Domination has the best correlation between Score and TotalXP at 0.72. The best to worst correlation order goes from Domination, Kill Confirmed, Hardpoint, to TDM. Looking at the box plot tells us that Kill Confirmed on average has a lower TotalXP compared to the other game types. When we switch to the Mean Score plot we see more of the same, Kill Confirmed is the only game type with a mean score of less than 3000.  




```{r}

#How does the game type affect TotalXP after accounting for the Score?
  
model <- lm(TotalXP ~ GameType + Score, data = df_cleaned)
summary(model)

```




**Discussion:** 



After accounting for the Score, the multiple linear regression model indicates varying effects of game type on TotalXP relative to Domination. Playing Hardpoint shows a positive trend, with an estimated increase of 121.76 TotalXP compared to Domination. Conversely, playing Kill Confirmed suggests a  significant negative impact, with an estimated decrease of about 3703.17 TotalXP compared to Domination. Similarly, playing TDM indicates a negative trend, with roughly 2570.44 less TotalXP compared to Domination. This indicates that while Score is a strong predictor of TotalXP, different game types can affect TotalXP differently. Examining for statistical significance tells us that Hardpoint and TDM are not statistically significant at the 0.05 level. Kill Confirmed with a p = 0.0632, however, shows some evidence of leading to lower TotalXP after considering a player's Score. This is backed up by our earlier plots and summary statistics. Overall, GameType affects TotalXP in many different ways, Kill Confirmed leading to a generally lower TotalXP is just the most significant example.  




## Task 4: Prediction

> Relevant Information: In this task, your goal is to compare a variety of classification methods. In particular, you should write your own research question that can be answered by comparing the effectiveness of various classification methodologies. To demonstrate your understanding of these methods, you should implement two classification methods from class, one of which must be random forest, and a third method that we will not cover in class. (The purpose of the using a method we did not cover is I want you to practice learning about a method and its implementation on your own. Basically, find a tutorial that explains the method and how to implement it.) You will then have to compare the results and decide which method was the most effective.

**Research Question:** Write your own question and be sure that the question and answer are clearly written in your report.

*Notes:* Since you will be using random forest, do not use a decision/classification tree as one of your other methods.

-   For this problem, you should provide a brief description of the methods that you will use. (A description is more than listing the name of the procedure. You should describe how the procedure works.)
-   You will implement and compare the effectiveness of these methods. As part of this process, you will have to make a number of decisions such as whether you will do any data wrangling.
-   *EX:* Maybe you remove partial matches, maybe you create new variables, etc.), which methods will you use, how will you fairly compare the results between methods, which method is best etc. **All of these decisions should be included in your report.**
-   **Warning:** If I have to learn about your decisions/analysis by reading your code, you will lose points.

*NOTE1:* You will make your life easier if you pick a response with a small number of levels.

*NOTE2:* As you are picking a method that we did not cover, one way to find techniques is by looking at the textbook that we have been covering: An Introduction to Statistical Learning with Applications in R by Gareth James et al. You can find a pdf of the textbook on the author’s site: <https://www.statlearning.com/>.

#### Deciding the Research Question

**Question:** Decide which game mode was played based off of the Map Choice, the Eliminations, Score, and the Time in Minutes and Seconds. 

```{r}
# DF with no time NA
COD_comb_w_t <- COD_combined %>%
  filter(!is.na(Time_Sec) & !is.na(Time_Min))

## Check num. of NA in Choice, Eliminations, Score, Damage, Deaths
sum(is.na(COD_comb_w_t$Choice)) 
sum(is.na(COD_comb_w_t$Eliminations))
sum(is.na(COD_comb_w_t$Score))
sum(is.na(COD_comb_w_t$Damage))
sum(is.na(COD_comb_w_t$Deaths))

COD_comb_w_t <- COD_comb_w_t %>%
  select(c(Time_Sec, Time_Min, Choice, Eliminations, Score, Damage, Deaths))

nrow(COD_comb_w_t) ## How many rows? Enough to do data analysis?

head(COD_comb_w_t)
```

The research question was decided based off of a filtered and combined dataset, "COD Combined with Time", or `Cod_comb_w_t` in the code. The reason why it is so important as to filter out numerous rows just to look at the time in Minutes and Seconds is because three out of four modes are based on a distinct time limit, and so it's a key variable in deciding which game mode is being played. 

Data wrangling also included checking the number of `NA`s in the dataset (to filter them out upon detection), and checking the remaining amount of match data (253), which is more than sufficient for predicting the four possible response levels for `CODGameModes` ("Domination", "Kill Confirmed", "Hardpoint", or "TDM"). 

